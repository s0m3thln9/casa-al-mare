<script setup lang="ts">
const props = defineProps<{
  size: "S" | "M" | "L" | "XL"
  modelValue: string | string[] | number | null
  label: string
  disabled?: boolean
  value: string | number
  multiple?: boolean
}>()

const emit = defineEmits<{
  (e: "update:modelValue", value: string | number | string[] | null): void
}>()

// Определяем режим работы
const isMultipleMode = computed(() => {
  if (props.multiple !== undefined) return props.multiple
  return Array.isArray(props.modelValue)
})

const isSelected = computed(() => {
  if (isMultipleMode.value && Array.isArray(props.modelValue)) {
    return props.modelValue.includes(String(props.value))
  }
  return String(props.modelValue) === String(props.value)
})

const toggle = () => {
  if (props.disabled) return

  if (isMultipleMode.value) {
    const currentArray = Array.isArray(props.modelValue) ? props.modelValue : []
    if (isSelected.value) {
      emit(
        "update:modelValue",
        currentArray.filter((v) => String(v) !== String(props.value)),
      )
    } else {
      emit("update:modelValue", [...currentArray, props.value])
    }
  } else {
    emit("update:modelValue", isSelected.value ? null : props.value)
  }
}
</script>

<template>
  <div
    class="flex gap-2 items-center select-none"
    :class="!disabled && 'cursor-pointer'"
    role="checkbox"
    :aria-checked="isSelected"
    @click="toggle"
  >
    <button
      :disabled="disabled"
      :class="[
        'flex justify-center items-center rounded-3xl border border-[#BBB8B6]',
        disabled ? 'bg-[#F9F6EC]' : 'cursor-pointer',
        size === 'S' && 'w-4 h-4',
        size === 'M' && 'w-5 h-5',
        size === 'L' && 'w-6 h-6',
        size === 'XL' && 'w-8 h-8',
        isSelected && 'bg-[#211D1D] border-[#F9F6EC]',
      ]"
    >
      <NuxtImg
        v-if="isSelected"
        src="/check.svg"
        alt="Check mark"
      />
    </button>
    <span class="text-sm font-light">{{ label }}</span>
  </div>
</template>
